# ğŸ“‹ é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸

## ğŸ¯ æ¦‚è¦

Claude Codeç”¨ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼è‡ªå‹•ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚npm run devãªã©ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¡ä¸Šã’ã£ã±ãªã—ã«ãªã‚‹ã“ã¨ã‚’é˜²ãã€ãƒ—ãƒ­ã‚»ã‚¹é‡è¤‡ã‚„ãƒãƒ¼ãƒˆç«¶åˆã‚’å›é¿ã™ã‚‹åŒ…æ‹¬çš„ãªç®¡ç†æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

### ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Code Hooks System                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PreToolUse    â”‚  PostToolUse   â”‚      Stop                    â”‚
â”‚  (Bash)        â”‚  (Bash)        â”‚  (Session End)               â”‚
â”‚       â”‚        â”‚       â”‚        â”‚       â”‚                      â”‚
â”‚       â–¼        â”‚       â–¼        â”‚       â–¼                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ç›£è¦–ãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Monitor   â”‚ â”‚   Cleanup   â”‚ â”‚   Manager   â”‚              â”‚
â”‚  â”‚   (ç›£è¦–)    â”‚ â”‚ (ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—) â”‚ â”‚  (çµ±åˆç®¡ç†)  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚               â”‚               â”‚                      â”‚
â”‚         â–¼               â–¼               â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Utils (å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£)                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   çŠ¶æ…‹ç®¡ç†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚active-serversâ”‚ â”‚   ports     â”‚ â”‚   pids/     â”‚              â”‚
â”‚  â”‚   .json     â”‚ â”‚   .json     â”‚ â”‚   *.pid     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ ä¸»è¦æ©Ÿèƒ½

1. **ãƒ—ãƒ­ã‚»ã‚¹é‡è¤‡æ¤œå‡º**: æ–°ã—ã„é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•å‰ã«æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹ã‚’è‡ªå‹•æ¤œå‡º
2. **ãƒãƒ¼ãƒˆç«¶åˆå›é¿**: 3000-3005ç•ªãƒãƒ¼ãƒˆã®ä½¿ç”¨çŠ¶æ³ã‚’ç›£è¦–
3. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: Claude Code ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
4. **çŠ¶æ…‹è¿½è·¡**: å…¨ã‚µãƒ¼ãƒãƒ¼ã®PIDã€ãƒãƒ¼ãƒˆã€å®Ÿè¡Œæ™‚é–“ã‚’JSONå½¢å¼ã§è¨˜éŒ²
5. **å¯¾è©±ãƒ¢ãƒ¼ãƒ‰**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼æ“ä½œ
6. **hooksçµ±åˆ**: Claude Code hooks ã‚·ã‚¹ãƒ†ãƒ ã¨ã®å®Œå…¨çµ±åˆ

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ« (`.claude/scripts/`)

```
.claude/scripts/
â”œâ”€â”€ dev-server-utils.sh        # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”œâ”€â”€ dev-server-monitor.sh      # ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–æ©Ÿèƒ½ (hooksç”¨)
â”œâ”€â”€ dev-server-cleanup.sh      # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ»åœæ­¢æ©Ÿèƒ½
â””â”€â”€ dev-server-manager.sh      # çµ±åˆç®¡ç†ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
```

### çŠ¶æ…‹ç®¡ç†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª (`.claude/dev-server-state/`)

```
.claude/dev-server-state/
â”œâ”€â”€ active-servers.json        # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§
â”œâ”€â”€ ports.json                 # ãƒãƒ¼ãƒˆä½¿ç”¨å±¥æ­´
â”œâ”€â”€ config.json                # ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
â”œâ”€â”€ pids/                      # PIDãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â””â”€â”€ {PID}.pid             # å€‹åˆ¥ãƒ—ãƒ­ã‚»ã‚¹æƒ…å ±
â””â”€â”€ README.md                  # çŠ¶æ…‹ç®¡ç†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```
.claude/settings.json          # Claude Code hooksè¨­å®š
```

## ğŸ”„ å‹•ä½œãƒ•ãƒ­ãƒ¼

### 1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ (PreToolUse)

```mermaid
graph TD
    A[Bash ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ] --> B{é–‹ç™ºã‚µãƒ¼ãƒãƒ¼<br/>ã‚³ãƒãƒ³ãƒ‰ã‹ï¼Ÿ}
    B -->|Yes| C[æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹æ¤œå‡º]
    B -->|No| Z[é€šå¸¸å‡¦ç†]
    C --> D{æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹<br/>ã‚ã‚Šï¼Ÿ}
    D -->|Yes| E[ãƒ—ãƒ­ã‚»ã‚¹æƒ…å ±è¡¨ç¤º]
    D -->|No| F[èµ·å‹•è¨±å¯]
    E --> G[ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ]
    G --> H[åœæ­¢/åˆ¥ãƒãƒ¼ãƒˆ/ã‚­ãƒ£ãƒ³ã‚»ãƒ«]
    H --> I[é¸æŠã«å¿œã˜ã¦å‡¦ç†]
    F --> J[ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ]
    I --> J
    J --> K[PostToolUse ã¸]
```

### 2. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¾Œ (PostToolUse)

```mermaid
graph TD
    A[ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå®Œäº†] --> B{é–‹ç™ºã‚µãƒ¼ãƒãƒ¼<br/>ã‚³ãƒãƒ³ãƒ‰ã‹ï¼Ÿ}
    B -->|Yes| C[æ–°ãƒ—ãƒ­ã‚»ã‚¹æ¤œå‡º]
    B -->|No| Z[å‡¦ç†çµ‚äº†]
    C --> D{æ–°ãƒ—ãƒ­ã‚»ã‚¹<br/>ã‚ã‚Šï¼Ÿ}
    D -->|Yes| E[PIDãƒ»ãƒãƒ¼ãƒˆæƒ…å ±å–å¾—]
    D -->|No| F[è­¦å‘Šè¡¨ç¤º]
    E --> G[PIDãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜]
    G --> H[ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒ¼ãƒãƒ¼æ›´æ–°]
    H --> I[ç™»éŒ²å®Œäº†é€šçŸ¥]
    F --> Z
    I --> Z
```

### 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ (Stop)

```mermaid
graph TD
    A[ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†] --> B[ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒ¼ãƒãƒ¼ç¢ºèª]
    B --> C{ã‚µãƒ¼ãƒãƒ¼<br/>ã‚ã‚Šï¼Ÿ}
    C -->|Yes| D[ã‚µãƒ¼ãƒãƒ¼æƒ…å ±è¡¨ç¤º]
    C -->|No| E[çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«<br/>ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—]
    D --> F{è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—<br/>æœ‰åŠ¹ï¼Ÿ}
    F -->|Yes| G[å…¨ã‚µãƒ¼ãƒãƒ¼åœæ­¢]
    F -->|No| H[æ‰‹å‹•åœæ­¢æ¡ˆå†…]
    G --> I[åœæ­¢çµæœè¡¨ç¤º]
    H --> E
    I --> E
```

## ğŸ“‹ å„ã‚¹ã‚¯ãƒªãƒ—ãƒˆè©³ç´°ä»•æ§˜

### 1. dev-server-utils.sh

**æ¦‚è¦**: å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã‚’æä¾›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**ä¸»è¦æ©Ÿèƒ½**:
- ãƒ—ãƒ­ã‚»ã‚¹æ¤œå‡ºãƒ»ç®¡ç†
- ãƒãƒ¼ãƒˆä½¿ç”¨çŠ¶æ³ç¢ºèª
- PIDç®¡ç†
- çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
- ãƒ­ã‚°å‡ºåŠ›

**ä¸»è¦é–¢æ•°**:

| é–¢æ•°å | æ©Ÿèƒ½ | å¼•æ•° | æˆ»ã‚Šå€¤ |
|--------|------|------|--------|
| `detect_dev_servers()` | é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹æ¤œå‡º | ãªã— | ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ |
| `is_port_in_use()` | ãƒãƒ¼ãƒˆä½¿ç”¨ç¢ºèª | port | 0/1 |
| `get_port_process()` | ãƒãƒ¼ãƒˆä½¿ç”¨ãƒ—ãƒ­ã‚»ã‚¹å–å¾— | port | ãƒ—ãƒ­ã‚»ã‚¹æƒ…å ± |
| `save_server_pid()` | PIDæƒ…å ±ä¿å­˜ | pid, port, path, session | ãªã— |
| `stop_process_gracefully()` | ãƒ—ãƒ­ã‚»ã‚¹å®‰å…¨åœæ­¢ | pid, timeout | 0/1 |
| `get_active_servers()` | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒ¼ãƒãƒ¼å–å¾— | ãªã— | JSONé…åˆ— |

**ç’°å¢ƒå¤‰æ•°**:
- `DEV_SERVER_LOG_LEVEL`: ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« (0-3)
- `CLAUDE_DIR`: Claudeè¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

### 2. dev-server-monitor.sh

**æ¦‚è¦**: hooks ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**ä½¿ç”¨æ–¹æ³•**:
```bash
echo "npm run dev" | dev-server-monitor.sh pre   # äº‹å‰ãƒã‚§ãƒƒã‚¯
echo "npm run dev" | dev-server-monitor.sh post  # äº‹å¾Œå‡¦ç†
```

**ä¸»è¦æ©Ÿèƒ½**:
- é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚³ãƒãƒ³ãƒ‰æ¤œå‡º
- æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹ç«¶åˆãƒã‚§ãƒƒã‚¯
- ãƒãƒ¼ãƒˆç«¶åˆè­¦å‘Š
- æ–°ãƒ—ãƒ­ã‚»ã‚¹ç™»éŒ²

**æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³**:
- `npm.*run.*dev`, `npm.*dev`
- `pnpm.*run.*dev`, `pnpm.*dev`
- `yarn.*dev`
- `next.*dev`
- `npx.*next.*dev`

**ç’°å¢ƒå¤‰æ•°**:
- `DEV_SERVER_AUTO_STOP`: è‡ªå‹•åœæ­¢æœ‰åŠ¹åŒ–

### 3. dev-server-cleanup.sh

**æ¦‚è¦**: é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®åœæ­¢ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã‚’æä¾›

**ä½¿ç”¨æ–¹æ³•**:
```bash
dev-server-cleanup.sh session-end           # ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†å‡¦ç†
dev-server-cleanup.sh stop <pid>            # ç‰¹å®šPIDåœæ­¢
dev-server-cleanup.sh stop-all              # å…¨ã‚µãƒ¼ãƒãƒ¼åœæ­¢
dev-server-cleanup.sh cleanup-orphaned      # å­¤ç«‹ãƒ—ãƒ­ã‚»ã‚¹å‰Šé™¤
dev-server-cleanup.sh status               # çŠ¶æ³è¡¨ç¤º
```

**ä¸»è¦ã‚³ãƒãƒ³ãƒ‰**:

| ã‚³ãƒãƒ³ãƒ‰ | æ©Ÿèƒ½ | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |
|----------|------|-----------|
| `session-end` | ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚å‡¦ç† | `--force` |
| `stop <pid>` | ç‰¹å®šãƒ—ãƒ­ã‚»ã‚¹åœæ­¢ | `--timeout N` |
| `stop-all` | å…¨ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢ | `--force` |
| `cleanup-orphaned` | å­¤ç«‹ãƒ—ãƒ­ã‚»ã‚¹å‰Šé™¤ | `--force` |
| `cleanup-state` | çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç† | ãªã— |
| `status` | ç¾åœ¨ã®çŠ¶æ³è¡¨ç¤º | ãªã— |

**ç’°å¢ƒå¤‰æ•°**:
- `DEV_SERVER_AUTO_CLEANUP`: è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æœ‰åŠ¹åŒ–
- `DEV_SERVER_CLEANUP_TIMEOUT`: åœæ­¢ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ(ç§’)

### 4. dev-server-manager.sh

**æ¦‚è¦**: çµ±åˆç®¡ç†ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»å¯¾è©±ãƒ¢ãƒ¼ãƒ‰

**ä½¿ç”¨æ–¹æ³•**:
```bash
dev-server-manager.sh                       # å¯¾è©±ãƒ¢ãƒ¼ãƒ‰
dev-server-manager.sh start "npm run dev"   # å®‰å…¨èµ·å‹•
dev-server-manager.sh stop <pid>            # ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢
dev-server-manager.sh status               # çŠ¶æ³è¡¨ç¤º
dev-server-manager.sh install              # hooks ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
dev-server-manager.sh test                 # ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
```

**ä¸»è¦ã‚³ãƒãƒ³ãƒ‰**:

| ã‚³ãƒãƒ³ãƒ‰ | æ©Ÿèƒ½ | èª¬æ˜ |
|----------|------|------|
| `start` | å®‰å…¨èµ·å‹• | æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèªå¾Œèµ·å‹• |
| `stop` | ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢ | ç‰¹å®šPIDåœæ­¢ |
| `stop-all` | å…¨åœæ­¢ | å…¨ã‚µãƒ¼ãƒãƒ¼åœæ­¢ |
| `status` | çŠ¶æ³ç¢ºèª | ç¾åœ¨ã®çŠ¶æ³è¡¨ç¤º |
| `cleanup` | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— | å­¤ç«‹ãƒ—ãƒ­ã‚»ã‚¹å‰Šé™¤ |
| `install` | hooks ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | settings.jsonæ›´æ–° |
| `uninstall` | hooks å‰Šé™¤ | settings.json ã‹ã‚‰å‰Šé™¤ |
| `test` | ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ | å‹•ä½œç¢ºèª |

**å¯¾è©±ãƒ¢ãƒ¼ãƒ‰æ©Ÿèƒ½**:
1. ç¾åœ¨ã®çŠ¶æ³è¡¨ç¤º
2. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
3. ã‚µãƒ¼ãƒãƒ¼åœæ­¢
4. å…¨ã‚µãƒ¼ãƒãƒ¼åœæ­¢
5. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
6. è¨­å®šç¢ºèª
7. ãƒ­ã‚°è¡¨ç¤º
8. ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ

## ğŸ“Š çŠ¶æ…‹ç®¡ç†

### active-servers.json

```json
{
  "activeServers": [
    {
      "pid": 12345,
      "port": 3000,
      "projectPath": "/workspace/knowledge/nextjs",
      "sessionId": "user-12345",
      "startTime": "2025-07-15T15:30:00Z"
    }
  ],
  "lastUpdated": "2025-07-15T15:30:00Z",
  "version": "1.0.0"
}
```

### ports.json

```json
{
  "portHistory": [
    {
      "port": 3000,
      "pid": 12345,
      "timestamp": "2025-07-15T15:30:00Z",
      "projectPath": "/workspace/knowledge/nextjs"
    }
  ],
  "defaultPorts": [3000, 3001, 3002, 3003, 3004, 3005],
  "lastUpdated": "2025-07-15T15:30:00Z",
  "version": "1.0.0"
}
```

### config.json

```json
{
  "autoStop": false,
  "autoCleanup": false,
  "cleanupTimeout": 10,
  "logLevel": 2,
  "monitoredPorts": [3000, 3001, 3002, 3003, 3004, 3005],
  "excludePatterns": ["grep", "dev-server"],
  "systemSettings": {
    "enableHooks": true,
    "sessionTracking": true,
    "processMonitoring": true
  },
  "lastUpdated": "2025-07-15T15:30:00Z",
  "version": "1.0.0"
}
```

### PIDãƒ•ã‚¡ã‚¤ãƒ« ({PID}.pid)

```json
{
  "pid": 12345,
  "port": 3000,
  "projectPath": "/workspace/knowledge/nextjs",
  "sessionId": "user-12345",
  "startTime": "2025-07-15T15:30:00Z",
  "commandLine": "npm run dev",
  "workingDirectory": "/workspace/knowledge/nextjs"
}
```

## âš™ï¸ è¨­å®šãƒ»ç’°å¢ƒå¤‰æ•°

### å¿…é ˆç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-------|-----------|------|
| `DEV_SERVER_LOG_LEVEL` | `2` | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« (0=ERROR, 1=WARN, 2=INFO, 3=DEBUG) |

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-------|-----------|------|
| `DEV_SERVER_AUTO_STOP` | `false` | è‡ªå‹•åœæ­¢æœ‰åŠ¹åŒ– |
| `DEV_SERVER_AUTO_CLEANUP` | `false` | è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æœ‰åŠ¹åŒ– |
| `DEV_SERVER_CLEANUP_TIMEOUT` | `10` | åœæ­¢ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ(ç§’) |
| `CLAUDE_DIR` | `$(pwd)/.claude` | Claudeè¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |

### hooksè¨­å®š (.claude/settings.json)

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [{
          "type": "command",
          "command": "bash -c 'if [ -f .claude/scripts/dev-server-monitor.sh ]; then echo \"$TOOL_INPUT\" | .claude/scripts/dev-server-monitor.sh pre; fi'"
        }]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Bash",
        "hooks": [{
          "type": "command",
          "command": "bash -c 'if [ -f .claude/scripts/dev-server-monitor.sh ]; then echo \"$TOOL_INPUT\" | .claude/scripts/dev-server-monitor.sh post; fi'"
        }]
      }
    ],
    "Stop": [
      {
        "hooks": [{
          "type": "command",
          "command": "bash -c 'if [ -f .claude/scripts/dev-server-cleanup.sh ]; then .claude/scripts/dev-server-cleanup.sh session-end; fi'"
        }]
      }
    ]
  }
}
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. åˆæœŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# hooks ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
.claude/scripts/dev-server-manager.sh install

# å‹•ä½œç¢ºèª
.claude/scripts/dev-server-manager.sh test
```

### 2. ç’°å¢ƒè¨­å®š (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

```bash
# è‡ªå‹•åœæ­¢ã‚’æœ‰åŠ¹åŒ–
export DEV_SERVER_AUTO_STOP=true

# è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’æœ‰åŠ¹åŒ–  
export DEV_SERVER_AUTO_CLEANUP=true

# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
export DEV_SERVER_CLEANUP_TIMEOUT=15
```

### 3. å‹•ä½œç¢ºèª

```bash
# ç¾åœ¨ã®çŠ¶æ³ç¢ºèª
.claude/scripts/dev-server-manager.sh status

# å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆ
.claude/scripts/dev-server-manager.sh
```

## ğŸ” ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªä½¿ç”¨ãƒ•ãƒ­ãƒ¼

1. **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•**:
   ```bash
   npm run dev
   ```
   â†’ è‡ªå‹•çš„ã«æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ

2. **é‡è¤‡æ¤œå‡ºæ™‚ã®é¸æŠ**:
   ```
   âš ï¸  æ—¢å­˜ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ:
      ğŸš€ npm (PID: 12345) - ãƒãƒ¼ãƒˆ 3000 - èµ·å‹•ã‹ã‚‰2æ™‚é–“
   
   é¸æŠã—ã¦ãã ã•ã„:
   1) æ—¢å­˜ã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢ã—ã¦æ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
   2) åˆ¥ã®ãƒãƒ¼ãƒˆã§æ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
   3) ã‚­ãƒ£ãƒ³ã‚»ãƒ«
   ```

3. **ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚**:
   ```
   ğŸ” ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ:
      ğŸš€ PID: 12345 - ãƒãƒ¼ãƒˆ: 3000 - å®Ÿè¡Œæ™‚é–“: 2æ™‚é–“
   
   ğŸ’¡ ãƒ’ãƒ³ãƒˆ: è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ DEV_SERVER_AUTO_CLEANUP=true ã‚’è¨­å®šã—ã¦ãã ã•ã„
   ```

### æ‰‹å‹•æ“ä½œä¾‹

```bash
# çŠ¶æ³ç¢ºèª
.claude/scripts/dev-server-manager.sh status

# ç‰¹å®šãƒ—ãƒ­ã‚»ã‚¹åœæ­¢
.claude/scripts/dev-server-cleanup.sh stop 12345

# å…¨ã‚µãƒ¼ãƒãƒ¼åœæ­¢
.claude/scripts/dev-server-cleanup.sh stop-all

# å­¤ç«‹ãƒ—ãƒ­ã‚»ã‚¹å‰Šé™¤
.claude/scripts/dev-server-cleanup.sh cleanup-orphaned

# å¯¾è©±ãƒ¢ãƒ¼ãƒ‰èµ·å‹•
.claude/scripts/dev-server-manager.sh
```

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãªã„**
   ```bash
   .claude/scripts/dev-server-cleanup.sh cleanup-orphaned
   ```

2. **ãƒãƒ¼ãƒˆç«¶åˆã‚¨ãƒ©ãƒ¼**
   ```bash
   .claude/scripts/dev-server-manager.sh status
   ```

3. **ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã‚‚ãƒ—ãƒ­ã‚»ã‚¹ãŒæ®‹ã‚‹**
   ```bash
   export DEV_SERVER_AUTO_CLEANUP=true
   ```

4. **hooks ãŒå‹•ä½œã—ãªã„**
   ```bash
   .claude/scripts/dev-server-manager.sh install
   ```

5. **çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æ**
   ```bash
   .claude/scripts/dev-server-cleanup.sh cleanup-state
   ```

### ãƒ­ã‚°ãƒ»ãƒ‡ãƒãƒƒã‚°

```bash
# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
export DEV_SERVER_LOG_LEVEL=3
.claude/scripts/dev-server-manager.sh status

# è©³ç´°ãƒ­ã‚°
DEV_SERVER_LOG_LEVEL=3 bash -x .claude/scripts/dev-server-monitor.sh pre <<< "npm run dev"
```

### æ‰‹å‹•ãƒªã‚»ãƒƒãƒˆ

```bash
# å…¨çŠ¶æ…‹ã‚¯ãƒªã‚¢
rm -rf .claude/dev-server-state/pids/*
echo '{"activeServers": []}' > .claude/dev-server-state/active-servers.json

# å¼·åˆ¶çš„ãªå…¨ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢
pkill -f "npm.*dev"
pkill -f "next.*dev"
```

## ğŸ“ˆ æ‹¡å¼µãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ç›£è¦–å¯¾è±¡ãƒ‘ã‚¿ãƒ¼ãƒ³è¿½åŠ 

`dev-server-utils.sh`ã®`DEV_SERVER_PATTERNS`é…åˆ—ã«è¿½åŠ :

```bash
readonly DEV_SERVER_PATTERNS=(
  "next.*dev"
  "node.*dev"
  "npm.*dev"
  "pnpm.*dev"
  "yarn.*dev"
  "npx.*dev"
  "custom.*dev"  # è¿½åŠ ä¾‹
)
```

### ç›£è¦–ãƒãƒ¼ãƒˆç¯„å›²å¤‰æ›´

`dev-server-utils.sh`ã®`DEFAULT_PORTS`é…åˆ—ã‚’å¤‰æ›´:

```bash
readonly DEFAULT_PORTS=(3000 3001 3002 3003 3004 3005 8000 8080)
```

### è‡ªå‹•åœæ­¢ãƒ­ã‚¸ãƒƒã‚¯å¼·åŒ–

`dev-server-monitor.sh`ã®`handle_user_choice`é–¢æ•°ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

1. **ãƒ—ãƒ­ã‚»ã‚¹æ¨©é™**: åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ã‚»ã‚¹ã®ã¿æ“ä½œ
2. **ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™**: çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯é©åˆ‡ãªãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³è¨­å®š
3. **ã‚³ãƒãƒ³ãƒ‰æ³¨å…¥**: å…¥åŠ›å€¤ã¯é©åˆ‡ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
4. **PIDæ¤œè¨¼**: ãƒ—ãƒ­ã‚»ã‚¹å­˜åœ¨ç¢ºèªã‚’å¿…é ˆå®Ÿè£…

## ğŸ“‹ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
- **æ›´æ–°æ—¥**: 2025-07-15
- **äº’æ›æ€§**: Claude Code hooks ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œ

## ğŸ¤ ã‚µãƒãƒ¼ãƒˆãƒ»è²¢çŒ®

å•é¡Œå ±å‘Šã‚„ãƒã‚°ä¿®æ­£ã¯ GitHub Issues ã§ç®¡ç†ã—ã¦ãã ã•ã„ã€‚

---

*ã“ã®ä»•æ§˜æ›¸ã¯é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v1.0.0 ã®å®Œå…¨ãªæŠ€è¡“ä»•æ§˜ã‚’è¨˜éŒ²ã—ã¦ã„ã¾ã™ã€‚*