# ナレッジベースシステム Next.js移植計画

## 📋 プロジェクト概要

### 目標
JavaベースのナレッジベースシステムをNext.js + TypeScriptに移植し、現在の見た目と機能をほぼ同等に再現する。

### 基本方針
- **段階的移植**: 機能優先度に基づく段階的実装
- **ページ単位移植**: JSPページ単位での移植により見た目を同等に保つ
- **GitHub Issue管理**: 親子関係を持つIssueで進捗管理
- **テスト駆動開発**: 各機能にテストを含める

## 🏗️ アーキテクチャ設計

### 技術スタック
- **フロントエンド**: Next.js 14 + TypeScript + Tailwind CSS
- **バックエンド**: Next.js API Routes
- **データベース**: PostgreSQL + Prisma ORM
- **認証**: NextAuth.js
- **UI**: Shadcn/ui (Bootstrap互換デザイン)
- **バリデーション**: Zod
- **テスト**: Jest + React Testing Library + Playwright

### ディレクトリ構造
```
/nextjs/
├── app/                    # Next.js 14 App Router
│   ├── (auth)/            # 認証関連ページ
│   ├── (protected)/       # ログイン必要ページ
│   ├── (public)/          # 公開ページ
│   ├── admin/             # 管理画面
│   └── api/               # API Routes
├── components/            # Reactコンポーネント
│   ├── ui/                # 基本UIコンポーネント
│   ├── forms/             # フォームコンポーネント
│   ├── knowledge/         # ナレッジ関連コンポーネント
│   └── layout/            # レイアウトコンポーネント
├── lib/                   # ユーティリティ関数
│   ├── db/                # データベース接続
│   ├── auth/              # 認証ロジック
│   ├── validations/       # バリデーションスキーマ
│   └── utils/             # 共通ユーティリティ
├── types/                 # TypeScript型定義
├── prisma/                # Prismaスキーマ・マイグレーション
└── tests/                 # テストファイル
```

## 📊 実装フェーズ計画

### フェーズ1: 基盤構築 (1-2週間)
**目標**: 基本的なプロジェクト構成と認証機能

#### 1.1 プロジェクトセットアップ
- [ ] Next.jsプロジェクト初期化
- [ ] Prismaセットアップ・スキーマ定義
- [ ] 基本コンポーネント構成
- [ ] Tailwind CSS + Shadcn/ui セットアップ

#### 1.2 データベース構築
- [ ] PostgreSQL環境構築
- [ ] 既存データのマイグレーション
- [ ] Prismaスキーマ完成・マイグレーション実行

#### 1.3 認証システム
- [ ] NextAuth.js セットアップ
- [ ] ログイン・ログアウト機能
- [ ] ユーザー登録機能
- [ ] パスワードリセット機能
- [ ] セッション管理

### フェーズ2: コア機能実装 (2-3週間)
**目標**: ナレッジの基本CRUD操作

#### 2.1 ナレッジ基本機能
- [ ] ナレッジ一覧表示
- [ ] ナレッジ詳細表示
- [ ] ナレッジ作成機能
- [ ] ナレッジ編集機能
- [ ] ナレッジ削除機能
- [ ] マークダウンエディタ・プレビュー

#### 2.2 検索・タグ機能
- [ ] 基本検索機能
- [ ] タグ管理
- [ ] タグ付けタグ検索

#### 2.3 ファイル管理
- [ ] ファイルアップロード機能
- [ ] ファイル表示・ダウンロード
- [ ] 画像表示機能

### フェーズ3: ソーシャル機能 (2-3週間)
**目標**: ユーザー間のインタラクション機能

#### 3.1 ソーシャル機能
- [ ] いいね機能
- [ ] コメント機能
- [ ] ストック機能

#### 3.2 ユーザー管理
- [ ] プロフィール表示・編集
- [ ] ユーザー設定
- [ ] アカウント画像管理

#### 3.3 グループ機能
- [ ] グループ作成・管理
- [ ] グループメンバー管理
- [ ] グループ権限管理

### フェーズ4: 通知・高度機能 (2-3週間)
**目標**: 通知システムと高度な機能

#### 4.1 通知システム
- [ ] 通知一覧・詳細
- [ ] メール通知機能
- [ ] リアルタイム通知

#### 4.2 高度機能
- [ ] 下書き機能
- [ ] 履歴管理
- [ ] テンプレート機能（必要に応じて）

### フェーズ5: 管理機能 (2-3週間)
**目標**: システム管理機能

#### 5.1 基本管理機能
- [ ] ユーザー管理
- [ ] システム設定
- [ ] お知らせ管理

#### 5.2 高度管理機能
- [ ] ログ管理
- [ ] 集計・レポート機能
- [ ] バックアップ・復旧

## 🎯 GitHub Issue構造設計

### 親Issue (Epic)
1. **基盤構築** - #1
2. **認証システム** - #2  
3. **ナレッジ基本機能** - #3
4. **ソーシャル機能** - #4
5. **通知システム** - #5
6. **管理機能** - #6

### 子Issue例（#3 ナレッジ基本機能）
- #3-1: ナレッジ一覧ページ実装
- #3-2: ナレッジ詳細ページ実装  
- #3-3: ナレッジ作成ページ実装
- #3-4: ナレッジ編集ページ実装
- #3-5: マークダウンエディタ実装
- #3-6: ファイルアップロード機能実装

### Issueテンプレート
```markdown
## 概要
[機能の概要]

## 移植対象
- **JavaController**: [対応するControllerクラス]
- **JSPページ**: [対応するJSPファイル]  
- **関連テーブル**: [使用するテーブル]

## 実装タスク
- [ ] API Route実装
- [ ] ページコンポーネント実装
- [ ] バリデーション実装  
- [ ] テスト実装
- [ ] 見た目調整

## 完了定義
- [ ] 旧システムと同等の機能
- [ ] 旧システムと同等の見た目
- [ ] テストの成功
- [ ] コードレビュー完了
```

## 🛠️ 開発ルール

### コミット規約
```
feat(#issue-number): 機能の概要

例: feat(#3-1): ナレッジ一覧ページの基本実装
```

### ブランチ戦略
- `main`: 本番ブランチ
- `develop`: 開発ブランチ  
- `feature/#issue-number`: 機能ブランチ

### PR規約
- Issue番号を必須記載
- 実装内容の詳細説明
- テスト結果の記載
- 見た目比較スクリーンショット（UI関連）

## 📋 マイグレーション管理

### データベースマイグレーション
1. **スキーママイグレーション**: Prismaで段階的実行
2. **データマイグレーション**: 既存データの移行スクリプト
3. **バックアップ戦略**: 各フェーズ前のデータバックアップ

### コンテンツマイグレーション  
1. **ユーザーデータ**: パスワードハッシュ形式の調整が必要
2. **ナレッジデータ**: マークダウン形式の検証・調整
3. **ファイル**: ファイルパス・保存方式の調整

## 🔧 開発環境セットアップ

### 必要なツール
- Node.js 18+
- PostgreSQL 14+
- pnpm（パッケージマネージャー）
- Docker（開発環境用）

### 環境変数
```env
DATABASE_URL="postgresql://user:password@localhost:5432/knowledge"
NEXTAUTH_SECRET="your-secret"
NEXTAUTH_URL="http://localhost:3000"
```

## 📈 進捗追跡

### 追跡指標
- Issue完了率
- テストカバレッジ
- 移植ページ数
- パフォーマンス指標

### 定期レビュー
- 週次進捗レビュー
- フェーズ完了時の振り返り
- 品質チェック

## ⚠️ リスク・注意事項

### 技術的リスク
- **認証システム移行**: パスワードハッシュ形式の違い
- **ファイル管理**: ファイル保存場所・URL構造の変更
- **パフォーマンス**: 大量データでの性能最適化

### 移植時の注意点
- **見た目の一致**: CSSクラス名・スタイルの詳細確認
- **機能の同等性**: エッジケースでの動作確認
- **データ整合性**: 既存データとの互換性確保

---

この計画に基づいて段階的に実装を進め、各フェーズで人間による確認・調整を行いながら品質の高い移植を実現します。